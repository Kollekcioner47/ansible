Задание: Использование шаблонов Ansible для настройки системного сообщения (MOTD)
Цель
Научиться применять шаблоны (Jinja2) в Ansible для генерации динамических конфигурационных файлов. В этом задании вы создадите playbook, который будет формировать файл /etc/motd (Message of the Day) на управляемых хостах, используя факты системы и переменные.

Предварительные требования
Установленная управляющая машина с Ansible.

Настроенный инвентарный файл с группой хостов, например [my_servers].

Доступ к целевым хостам по SSH с правами sudo (become).

На хостах должен быть установлен Python (обычно предустановлен).

Задание
Создайте playbook motd_config.yml, который:
Собирает факты о целевых хостах (включите сбор фактов, если он отключён по умолчанию — в нашем случае gather_facts: yes или не указывайте, так как по умолчанию yes).
Использует шаблон для создания файла /etc/motd со следующим содержимым (динамически подставленным):


****************************************************
Добро пожаловать на сервер {{ ansible_hostname }}
----------------------------------------------------
Система: {{ ansible_distribution }} {{ ansible_distribution_version }}
IP-адрес: {{ ansible_default_ipv4.address }}
Сгенерировано: {{ ansible_date_time.iso8601 }}
****************************************************

(Обратите внимание: ansible_date_time доступен только при включённом сборе фактов.)

Учитывает переменные:
Для хостов из группы development добавьте в конец сообщения предупреждение: "Это тестовый сервер. Будьте осторожны!"
Для всех остальных хостов добавьте: "Это production сервер. Все изменения согласовывайте с администратором."
Используйте для этого переменную env или групповые переменные. Например, можно определить в инвентаре для группы development переменную env: dev, а для остальных env: prod. В шаблоне примените конструкцию {% if ... %}.
Устанавливает права на файл /etc/motd 0644 (владелец root, группа root).
Не использует хендлеры, так как для MOTD не требуется перезапуск служб.

Требования к playbook
Используйте модуль template.
Шаблон должен находиться в директории templates/ рядом с playbook и называться motd.j2.
Все переменные должны быть либо взяты из фактов, либо определены в инвентаре или групповых vars.
В playbook не должно быть жёстко прописанных IP и имён — только шаблон и переменные.
Playbook должен быть готов к запуску командой:

ansible-playbook -i inventory motd_config.yml
Подготовка инвентаря
Пример инвентарного файла inventory.ini:

ini
[development]
dev1 ansible_host=192.168.1.10
dev2 ansible_host=192.168.1.11

[production]
prod1 ansible_host=192.168.1.20
prod2 ansible_host=192.168.1.21

[development:vars]
env=dev

[production:vars]
env=prod
Шаблон templates/motd.j2
Примерная структура:

jinja2
****************************************************
Добро пожаловать на сервер {{ ansible_hostname }}
----------------------------------------------------
Система: {{ ansible_distribution }} {{ ansible_distribution_version }}
IP-адрес: {{ ansible_default_ipv4.address }}
Сгенерировано: {{ ansible_date_time.iso8601 }}
****************************************************
{% if env == 'dev' %}
** ВНИМАНИЕ: Это тестовый сервер. Будьте осторожны! **
{% elif env == 'prod' %}
** ВНИМАНИЕ: Это production сервер. Все изменения согласовывайте с администратором. **
{% endif %}

Подсказки
Для сбора фактов о времени используйте ansible_date_time. Убедитесь, что сбор фактов включён (по умолчанию включён, если не отключён в playbook).
Если у хоста несколько IP, можно использовать ansible_default_ipv4.address или перебирать все интерфейсы.
Для проверки прав доступа можно использовать модуль file после шаблона, но проще указать параметр mode прямо в задаче template.
Чтобы проверить результат, подключитесь к хосту по SSH — при входе должно отображаться новое MOTD. Либо прочитайте файл командой cat /etc/motd.
